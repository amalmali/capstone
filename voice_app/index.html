<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>๐ Geospatial Assistance System</title>
</head>
<body>

    <h2>๐ Geospatial Assistance System</h2>
    <p>ูุณุงุนุฏ ุตูุชู ุฐูู + ูุญุต ููุงูู (ุฏุงุฎู / ุฎุงุฑุฌ ูุทุงู)</p>

    <hr>

    <!-- =========================
         ๐ค ุงููุณู ุงูุตูุชู
    ========================== -->

    <h3>๐ค ุงููุณุงุนุฏ ุงูุตูุชู</h3>

    <button id="startBtn">ุงุจุฏุฃ ุงูุชุณุฌูู</button>
    <button id="stopBtn" disabled>ุฅููุงู ุงูุชุณุฌูู</button>

    <p><strong>ุงูุฌูุงุจ:</strong></p>
    <p id="answerText">---</p>

    <audio id="audioPlayer" controls></audio>

    <hr>

    <!-- =========================
         ๐ ุงููุณู ุงูุฌุบุฑุงูู (ุชุตููู ููุท ุญุงููุงู)
    ========================== -->

    <h3>๐ ุงููุญุต ุงูุฌุบุฑุงูู (Geospatial Check)</h3>

    <label>Latitude:</label>
    <input type="text" id="latInput" placeholder="ูุซุงู: 21.4858"><br><br>

    <label>Longitude:</label>
    <input type="text" id="lonInput" placeholder="ูุซุงู: 39.1925"><br><br>

    <button id="checkLocationBtn">ุชุญูู ูู ุงููููุน</button>

    <p id="geoResult">---</p>

    <hr>

    <script>
        // =========================
        // ๐ค ุงูุฌุฒุก ุงูุตูุชู (ููุง ูุงู ุดุบุงู)
        // =========================

        let mediaRecorder;
        let audioChunks = [];

        const startBtn = document.getElementById("startBtn");
        const stopBtn = document.getElementById("stopBtn");
        const audioPlayer = document.getElementById("audioPlayer");
        const answerText = document.getElementById("answerText");

        startBtn.onclick = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = async () => {
                const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                const formData = new FormData();
                formData.append("file", audioBlob, "recording.wav");

                // ุฅุฑุณุงู ุงูุตูุช ุฅูู FastAPI
                const response = await fetch("/ask", {
                    method: "POST",
                    body: formData
                });

                // ุงุณุชูุงู ุงูุตูุช ุงููุงุชุฌ ูุชุดุบููู ูุจุงุดุฑุฉ
                const audioData = await response.blob();
                const audioURL = URL.createObjectURL(audioData);
                audioPlayer.src = audioURL;
                audioPlayer.play();
            };

            mediaRecorder.start();
            startBtn.disabled = true;
            stopBtn.disabled = false;
        };

        stopBtn.onclick = () => {
            mediaRecorder.stop();
            startBtn.disabled = false;
            stopBtn.disabled = true;
        };

        // =========================
        // ๐ ุงูุฌุฒุก ุงูุฌุบุฑุงูู (ุชุตููู ููุท ุญุงููุงู)
        // =========================

        const checkBtn = document.getElementById("checkLocationBtn");
        const latInput = document.getElementById("latInput");
        const lonInput = document.getElementById("lonInput");
        const geoResult = document.getElementById("geoResult");

        checkBtn.onclick = () => {
            const lat = latInput.value;
            const lon = lonInput.value;

            if (!lat || !lon) {
                geoResult.innerText = "โ ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฎุท ุงูุนุฑุถ ูุงูุทูู.";
                return;
            }

            // ุญุงููุงู ูุฌุฑุฏ ุนุฑุถ ุชุฌุฑูุจู (ุณูุฑุจุทู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุญูุงู)
            geoResult.innerText = `๐ ุชู ุงุณุชูุงู ุงูุฅุญุฏุงุซูุงุช:
Latitude = ${lat}
Longitude = ${lon}

(ุณูุชู ูุงุญูุงู ุงูุชุญูู ุฅุฐุง ูุงูุช ุงูููุทุฉ ุฏุงุฎู ุงูุจูููุฌูู ุฃู ูุง)`;
        };
    </script>

</body>
</html>

