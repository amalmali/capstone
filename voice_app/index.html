<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ù„Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø­Ù…ÙŠØ©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 60px;
            background: #f5f7fa;
        }
        h1 { color: #2c3e50; }
        button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #startBtn { background-color: #27ae60; color: white; }
        #stopBtn { background-color: #c0392b; color: white; }
        #status { margin-top: 20px; font-size: 18px; }
        #result {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 60%;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<h1>ğŸ¤ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ù„Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø­Ù…ÙŠØ©</h1>

<button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
<button id="stopBtn" disabled>Ø¥ÙŠÙ‚Ø§Ù</button>

<div id="status">Ø§Ø¶ØºØ·ÙŠ "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" ÙˆØªØ­Ø¯Ø«ÙŠ Ø¨Ø§Ù„Ø³Ø¤Ø§Ù„</div>

<div id="result" style="display:none;">
    <h3>ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:</h3>
    <p id="questionText"></p>

    <h3>ğŸ¤– Ø¬ÙˆØ§Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…:</h3>
    <p id="answerText"></p>

    <h3>ğŸ”Š Ø§Ù„ØµÙˆØª:</h3>
    <audio id="audioPlayer" controls></audio>
</div>

<script>
let mediaRecorder;
let audioChunks = [];

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const statusDiv = document.getElementById("status");

startBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];

    mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
    };

    mediaRecorder.start();
    statusDiv.innerText = "ğŸ™ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... ØªÙƒÙ„Ù‘Ù…ÙŠ Ø§Ù„Ø¢Ù†";
    startBtn.disabled = true;
    stopBtn.disabled = false;
};

stopBtn.onclick = async () => {
    mediaRecorder.stop();
    statusDiv.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª ÙˆÙ…Ø¹Ø§Ù„Ø¬ØªÙ‡...";
    startBtn.disabled = false;
    stopBtn.disabled = true;

    mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
        const formData = new FormData();
        formData.append("file", audioBlob, "recorded.wav");

        const response = await fetch("http://127.0.0.1:8000/ask", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        document.getElementById("result").style.display = "block";
        document.getElementById("questionText").innerText = data.question_text;
        document.getElementById("answerText").innerText = data.answer_text;

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù†Ø§ØªØ¬ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        const audioPlayer = document.getElementById("audioPlayer");
        audioPlayer.src = data.audio_file + "?t=" + new Date().getTime(); // Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒØ§Ø´
        audioPlayer.load();

        statusDiv.innerText = "âœ… ØªÙ…! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø±";
    };
};
</script>

</body>
</html>
