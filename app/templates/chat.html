<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ø°ÙƒÙŠ | Ø§Ù„ÙƒØ´Ùƒ Ø§Ù„Ø°ÙƒÙŠ</title>

    <style>
        :root {
            --primary-bg: #0f172a;
            --card-bg: #1e293b;
            --accent-blue: #38bdf8;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-purple: #8b5cf6;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
        }

        body {
            margin: 0;
            background: var(--primary-bg);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .header { text-align: center; margin-bottom: 16px; }
        .header h1 { margin: 0; font-size: 1.8rem; color: var(--accent-blue); }
        .header p { color: var(--text-dim); margin-top: 6px; }

        .mode-selector {
            display: flex; gap: 10px; margin-bottom: 18px;
            background: var(--card-bg); padding: 8px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .mode-btn {
            padding: 10px 20px; border-radius: 40px; border: none;
            cursor: pointer; background: transparent; color: var(--text-dim);
            font-weight: bold; transition: 0.3s;
        }

        .mode-btn.active {
            background: var(--accent-blue); color: white;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
        }

        .interaction-container {
            width: 100%; max-width: 900px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; margin-bottom: 14px;
        }

        #voice-section { display: flex; flex-direction: column; align-items: center; }
        .circle-btn {
            width: 150px; height: 150px; border-radius: 50%;
            border: none; background: var(--accent-blue); color: white;
            cursor: pointer; transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; gap: 8px; user-select: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .circle-btn.listening { background: var(--accent-red) !important; }
        .circle-btn.thinking { background: var(--accent-purple) !important; }

        #text-section { 
            display: none; width: 100%;
            background: var(--card-bg); padding: 14px; border-radius: 16px;
        }

        #output-area {
            width: 100%; max-width: 900px; flex: 1;
            overflow-y: auto; padding-bottom: 120px;
        }

        .chat-card {
            background: var(--card-bg); padding: 20px; border-radius: 16px;
            border-right: 5px solid var(--accent-blue);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 12px;
        }

        #user-q { color: var(--accent-blue); font-size: 0.9rem; margin-bottom: 8px; font-weight: bold; display: none; }
        #bot-p { line-height: 1.8; font-size: 1.05rem; }

        .gps-form-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 14px;
            width: 100%;
        }

        .gps-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .gps-grid input {
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: #0f172a;
            color: white;
        }

        .gps-actions button {
            padding: 10px 18px; border-radius: 10px; border: none;
            background: var(--accent-blue); color: white; font-weight: bold;
        }

        #gps-alert-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            padding: 16px; text-align: center; font-weight: bold;
            background: #334155; color: white;
        }
    </style>
</head>

<body>

<div class="header">
    <h1>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h1>
    <p id="status-text">Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©</p>
</div>

<div id="output-area">

    <div class="chat-card">
        <div id="user-q">Ø³Ø¤Ø§Ù„Ùƒ: <span id="user-text"></span></div>
        <div id="bot-p">
            Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°ÙƒÙŠ.
        </div>
    </div>

    <!-- ====== Ø§Ù„Ø®Ø±ÙŠØ·Ø© ====== -->
    <div id="map-container" style="margin-top: 14px; display: none;">
        <div class="chat-card">
            <h3 style="color: var(--accent-blue); margin-top: 0;">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h3>
            <iframe id="map-frame" width="100%" height="450px" style="border:none; border-radius:12px;"></iframe>
        </div>
    </div>

</div>

<div id="gps-alert-bar">
    <span>ğŸ“¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²</span>
</div>

<script>
    async function processRequest(query) {
        const formData = new FormData();
        if (query) formData.append('query', query);
        formData.append('use_voice', 'false');

        const resp = await fetch('/llm/voice-interaction', { method: 'POST', body: formData });
        const data = await resp.json();

        if (data.status === 'success' && data.map_path) {
            const mapContainer = document.getElementById("map-container");
            const mapFrame = document.getElementById("map-frame");
            mapContainer.style.display = "block";
            mapFrame.src = data.map_path;
        }
    }

    // ğŸ”¥ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    window.onload = async function() {
        await processRequest("Ø§Ø±Ø³Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø©");
    };
</script>

</body>
</html>
